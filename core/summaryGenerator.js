/*
 * ─────────────────────────────────────────────────────────────
 *                       ORIGIN LITE MODE
 *                       INTERNAL MODULE
 * ─────────────────────────────────────────────────────────────
 *
 *  WARNING:
 *  This file is part of Origin Lite Mode’s internal scanning
 *  engine. It is not a public API and not designed for reuse,
 *  modification, or redistribution.
 *
 *  Changing, copying, or altering this file may cause:
 *    • auditEngine failure
 *    • incorrect scan results
 *    • unstable CLI behavior
 *    • loss of Lite Mode protections
 *    • invalid preview generation
 *
 *  The full, stable, and extended scanning engine is available
 *  ONLY in Origin Pro. Lite Mode contains intentionally limited
 *  and obfuscated logic for security and upgrade protection.
 *
 *  Proceed at your own risk. This module is NOT considered a
 *  stable API surface and may break without notice.
 *
 *  © Dipz Origin — Protected Internal Logic
 * ─────────────────────────────────────────────────────────────
 */

import pc from "picocolors";

/*
 * Generate markdown summary for docs/ai/bridge_summary.md
 * Lite Mode Only — Pro version has full maps.
 */
export function generateSummary({
  project,
  files,
  framework,
  components,
  pages,
  features,
  ui,
  hints,
  backendExists,
  relationships,
  relationshipsTotal,
  duplicates,
  deadFiles,
  unusedDeps,
  timestamp,
}) {
  const uiFormatted = ui.length ? ui.map((u) => `- ${u}`).join("\n") : "None";

  const hintsFormatted =
    hints.length > 0 ? hints.map((h) => `- ${h}`).join("\n") : "None";

  return `
# Origin Lite Summary

Generated: **${timestamp}**

## Overview
- **Project:** ${project}
- **Files Scanned:** ${files.length}
- **Framework:** ${framework}

---

## Components (Preview)
${components.slice(0, 10).join("\n")}
${components.length > 10 ? `+${components.length - 10} more (Pro)` : ""}

## Pages (Preview)
${pages.slice(0, 10).join("\n")}
${pages.length > 10 ? `+${pages.length - 10} more (Pro)` : ""}

## Features (Preview)
${features.slice(0, 10).join("\n")}
${features.length > 10 ? `+${features.length - 10} more (Pro)` : ""}

## UI System
${uiFormatted}

## Component Relationships (Preview)
${relationships
  .slice(0, 3)
  .map((r) => `- ${r}`)
  .join("\n")}
${relationshipsTotal > 3 ? `+${relationshipsTotal - 3} more (Pro)` : ""}

## Possible Duplicates (Preview)
${duplicates.preview.slice(0, 3).join("\n") || "None"}
${duplicates.total > 3 ? `+${duplicates.total - 3} more (Pro)` : ""}

## Dead Files (Preview)
${deadFiles.preview.slice(0, 5).join("\n") || "None"}
${deadFiles.total > 5 ? `+${deadFiles.total - 5} more (Pro)` : ""}

## Unused Dependencies (Preview)
${unusedDeps.preview.slice(0, 3).join("\n") || "None"}
${unusedDeps.total > 3 ? `+${unusedDeps.total - 3} more (Pro)` : ""}

## Structure Hints (Lite)
${hintsFormatted}

---
_Generated by Origin Lite Mode_
`;
}

/* ---------------- HEALTH SCORE (Lite Mode) ---------------- */
export function computeHealthScore({ features, ui, hints }) {
  let score = 100;

  if (hints.length > 0) score -= Math.min(hints.length * 5, 40);
  if (features.length === 0) score -= 20;
  if (ui.length === 0) score -= 10;

  return Math.max(40, score);
}
